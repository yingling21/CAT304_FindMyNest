"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.useNavigationTracker=void 0;var _react=require("react");var _OptionalReactNativeNavigation=require("../optional/OptionalReactNativeNavigation");var _usePostHog=require("./usePostHog");function _useNavigationTrackerDisabled(){return;}function _useNavigationTracker(options,navigationRef,client){var contextClient=(0,_usePostHog.usePostHog)();var posthog=client||contextClient;if(!_OptionalReactNativeNavigation.OptionalReactNativeNavigation){throw new Error('No OptionalReactNativeNavigation');}var routes=undefined;var navigation=navigationRef;try{routes=_OptionalReactNativeNavigation.OptionalReactNativeNavigation.useNavigationState(function(state){return state===null||state===void 0?void 0:state.routes;});}catch(error){console.error('useNavigationState error',error);}try{if(!navigation){navigation=_OptionalReactNativeNavigation.OptionalReactNativeNavigation.useNavigation();}}catch(error){console.error('useNavigation error',error);return;}var trackRoute=(0,_react.useCallback)(function(){var _a,_b,_c;if(!navigation){return;}var currentNavigation=navigation;if(navigation.current){currentNavigation=navigation.current;}var currentRoute=undefined;try{var isReady=false;try{isReady=currentNavigation.isReady();}catch(error){isReady=true;}if(!isReady){return;}currentRoute=currentNavigation.getCurrentRoute();}catch(error){return;}if(!currentRoute){return;}var _currentRoute=currentRoute,state=_currentRoute.state;var _currentRoute2=currentRoute,name=_currentRoute2.name,params=_currentRoute2.params;if((_a=state===null||state===void 0?void 0:state.routes)===null||_a===void 0?void 0:_a.length){var route=state.routes[state.routes.length-1];name=route.name;params=route.params;}var currentRouteName=((_b=options===null||options===void 0?void 0:options.routeToName)===null||_b===void 0?void 0:_b.call(options,name,params))||name||'Unknown';if(currentRouteName){var properties=(_c=options===null||options===void 0?void 0:options.routeToProperties)===null||_c===void 0?void 0:_c.call(options,currentRouteName,params);posthog.screen(currentRouteName,properties);}},[navigation,options,posthog]);(0,_react.useEffect)(function(){if(!routes){setTimeout(trackRoute,1);return;}trackRoute();},[routes,trackRoute]);}var useNavigationTracker=exports.useNavigationTracker=_OptionalReactNativeNavigation.OptionalReactNativeNavigation?_useNavigationTracker:_useNavigationTrackerDisabled;