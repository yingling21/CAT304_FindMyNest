"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.trackConsole=trackConsole;exports.trackUncaughtExceptions=trackUncaughtExceptions;exports.trackUnhandledRejections=trackUnhandledRejections;var _utils=require("../utils");function trackUnhandledRejections(tracker){var _a,_b,_c;if((0,_utils.isHermes)()&&((_a=_utils.GLOBAL_OBJ===null||_utils.GLOBAL_OBJ===void 0?void 0:_utils.GLOBAL_OBJ.HermesInternal)===null||_a===void 0?void 0:_a.enablePromiseRejectionTracker)&&((_c=(_b=_utils.GLOBAL_OBJ===null||_utils.GLOBAL_OBJ===void 0?void 0:_utils.GLOBAL_OBJ.HermesInternal)===null||_b===void 0?void 0:_b.hasPromise)===null||_c===void 0?void 0:_c.call(_b))){_utils.GLOBAL_OBJ.HermesInternal.enablePromiseRejectionTracker({allRejections:true,onUnhandled:function onUnhandled(_,error){return tracker(error,false);},onHandled:function onHandled(){}});}else if((0,_utils.isWeb)()){addWebUnhandledRejectionListener(tracker);}else{throw new Error('Promise rejection tracking is only supported on Web and Hermes runtime');}}function trackUncaughtExceptions(tracker){var _a,_b;if((_utils.GLOBAL_OBJ===null||_utils.GLOBAL_OBJ===void 0?void 0:_utils.GLOBAL_OBJ.ErrorUtils)&&((_a=_utils.GLOBAL_OBJ.ErrorUtils)===null||_a===void 0?void 0:_a.setGlobalHandler)&&((_b=_utils.GLOBAL_OBJ.ErrorUtils)===null||_b===void 0?void 0:_b.getGlobalHandler)){var globalHandler=ErrorUtils.getGlobalHandler();ErrorUtils.setGlobalHandler(function(error,isFatal){tracker(error,isFatal!==null&&isFatal!==void 0?isFatal:false);globalHandler===null||globalHandler===void 0?void 0:globalHandler(error,isFatal);});}else{throw new Error('ErrorUtils globalHandlers are not defined');}}function trackConsole(level,tracker){var con=console;if(!con){throw new Error('console not available, cannot wrap console.error');}var originalMethod=con[level];con[level]=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}var message=args.join(' ');var error=args.find(function(arg){return arg instanceof Error;});var syntheticException=new Error('Synthetic PostHog Error');tracker(error!==null&&error!==void 0?error:message,false,syntheticException);return originalMethod===null||originalMethod===void 0?void 0:originalMethod.apply(void 0,args);};}function addWebUnhandledRejectionListener(tracker){var _oldUnhandledRejectionHandler=_utils.GLOBAL_OBJ.onunhandledrejection;_utils.GLOBAL_OBJ.onunhandledrejection=function(event){tracker(event,false);if(_oldUnhandledRejectionHandler){_oldUnhandledRejectionHandler.apply(_utils.GLOBAL_OBJ,[event]);}};}